#!/bin/sh

for d in /sys/bus/usb/devices/*; do
        [ -d "$d" ] || continue
        [ -f "$d/idVendor" ] || continue
        dev="${d##*/}"
        vendor="$(cat "$d/idVendor")"
        product="$(cat "$d/idProduct")"
        productname="$(cat "$d/product")"
        manufacturername="$(cat "$d/manufacturer")"
        has_subdevs=no
        for sub in "$d"/*/driver; do
                [ -d "$sub" ] || continue
                dev="${sub%/driver}"
                dev="${dev##*/}"
                has_subdevs=yes
                driver="$(ls -ld "$sub")"
                driver="${driver##*/}"
                printf '%s:%s %010s %012s (%s - %s) \n' "$vendor" "$product" "$dev" "$driver" "$productname" "$manufacturername"
        done
        if [ "$has_subdevs" = no ]; then
                driver="--NODRIVER--"
                printf '%s:%s %010s %012s (%s - %s) \n' "$vendor" "$product" "$dev" "$driver" "$productname" "$manufacturername"
        fi
done

